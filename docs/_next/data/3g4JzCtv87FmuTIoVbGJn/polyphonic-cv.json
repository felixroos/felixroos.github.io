{"pageProps":{"frontmatter":{"title":"Polyphonic MIDI to CV","date":"2021-05-22","tags":["diy","synthesis","electronics"],"description":"After looking at the basics of analog synthesis in the last post let's now look at how to approach polyphony.","image":"./img/MCP4728.png"},"code":"var Component=(()=>{var r=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>c(a,\"__esModule\",{value:!0});var m=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),k=(a,n)=>{i(a);for(var s in n)c(a,s,{get:n[s],enumerable:!0})},N=(a,n,s)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let t of d(n))!u.call(a,t)&&t!==\"default\"&&c(a,t,{get:()=>n[t],enumerable:!(s=p(n,t))||s.enumerable});return a},g=a=>N(i(c(a!=null?r(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((C,l)=>{l.exports=_jsx_runtime});var y={};k(y,{default:()=>b,frontmatter:()=>w});var e=g(o()),w={title:\"Polyphonic MIDI to CV\",date:\"2021-05-22\",tags:[\"diy\",\"synthesis\",\"electronics\"],description:\"After looking at the basics of analog synthesis in the last post let's now look at how to approach polyphony.\",image:\"./img/MCP4728.png\"};function f(a){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",img:\"img\",em:\"em\",h3:\"h3\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\"},a.components),{wrapper:s}=n,t=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"After looking at the basics of analog synthesis in the \",(0,e.jsx)(n.a,{href:\"../analog-synthesis\",children:\"last post\"}),`,\nlet's now look at how to approach polyphony.`]}),`\n`,(0,e.jsx)(n.p,{children:`So far, I used the Arturia Keystep to send pitch and gate CV to the VCO.\nTo be able to play multiple notes at once, we need multiple channels of pitch and gate CV.`}),`\n`,(0,e.jsxs)(n.h2,{id:\"midi-to-cv\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#midi-to-cv\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"MIDI to CV\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Using an Arduino + a DAC (= Digital to Analog Converter), we can set the pitch CV output to an analog voltage whenever a MIDI note message is received:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/idea.png\",alt:\"idea\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The Arduino receives a MIDI note message, calculates the correct voltage for that note and sends the voltage through the DAC to the VCO.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"digital-to-analog-conversion\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#digital-to-analog-conversion\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Digital to Analog Conversion\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Without a DAC, an Arudino is not able to produce \",(0,e.jsx)(n.em,{children:\"true analog output\"}),\"\\u2122, meaning a voltage that is not either 0V or 5V.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"what-about-analogwrite\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-about-analogwrite\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What about analogWrite?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`If you've already worked with Arduino, you might know the analogWrite function, which suggests that we output an analog voltage.\nBut in fact, analogWrite will only output a `,(0,e.jsx)(n.a,{href:\"https://www.arduino.cc/en/Tutorial/Foundations/PWM\",children:\"PWM wave\"}),\", which looks like this:\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"https://www.arduino.cc/wiki/54ef6da144b4531dd9ada686a7e67c56/pwm.gif\",alt:\"pwm waves\"})}),`\n`,(0,e.jsx)(n.p,{children:\"So this is still just a digital signal. It can be useful to dim LEDs for example, but it's not sufficient for a VCO.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"poor-mans-dac\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#poor-mans-dac\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Poor Mans DAC\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`What i heard somewhere referred to as the \"Poor Mans DAC\", is by filtering the PWM output of the arduino.\nThis will filter out the higher frequencies of the pulse wave, leaving a more or less mean value.\nYou can read more about it `,(0,e.jsx)(n.a,{href:\"https://create.arduino.cc/projecthub/Arduino_Scuola/build-a-simple-dac-for-your-arduino-4c00bd\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"I tested this too (using a TL074 instead of a TL2451):\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/poormansdac.png\",alt:\"poor mands dac\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The problem: In my test, I could only get a voltage range from 1.7V to 4.4V, which only gives us 3 octaves (at 1V/octave) + the resulting voltage was very shaky.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The next thing I tried was a resistor ladder.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"resistor-ladder\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#resistor-ladder\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Resistor Ladder\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can use a bunch of resistors and arrange them to a so called resistor ladder to build a proper DAC:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/resistor-ladder-sketch.png\",alt:\"resistor ladder\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Essentially, we are using a multi layered \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Voltage_divider\",children:\"Voltage Divider\"}),`.\nThe lower row of resistors are 2K and the upper row are 1K.\nTo read more on how and why it works, I recommend `,(0,e.jsx)(n.a,{href:\"https://create.arduino.cc/projecthub/instrumentation-system/dac-8-bit-using-r-2r-ladder-964837\",children:\"this article\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Using this code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" value \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// value between 0 and 255\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" bits \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\" bits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" digit \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" digit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`The value can be set between 0 and 255 (= 256 values = 2^8 = 8 bit DAC).\nIf we measure the voltage, we get approximately 2.5V for 127:`}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/resistor-ladder.png\",alt:\"resistor ladder\"})}),`\n`,(0,e.jsx)(n.p,{children:`Let's step up the game once more and look at an even better solution, as we would quickly run out of\noutput pins if we built our multi channel dac with resistor ladders.`}),`\n`,(0,e.jsxs)(n.h3,{id:\"using-the-mcp4728\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#using-the-mcp4728\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Using the MCP4728\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Using an IC DAC, like the MCP4728, we can have 4 channel \",(0,e.jsx)(n.em,{children:\"true analog output\"}),`\\u2122 without using zillions of pins.\nThe integration is really easy with a breakout board, like the one from Adafruit:`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/mcp4728-sketch.png\",alt:\"mcp4728\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Basic demo for configuring the MCP4728 4-Channel 12-bit I2C DAC\"}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"<Adafruit_MCP4728.h>\"})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"<Wire.h>\"})]}),`\n\nAdafruit_MCP4728 mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"begin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"115200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"Serial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// will pause Zero, Leonardo, etc until serial console opens\"}),`\n\n  Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Adafruit MCP4728 test!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Try to initialize!\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"mcp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"begin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Failed to find MCP4728 chip\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4095\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_B\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2048\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_C\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1024\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_D\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"Reading Channel B:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/mcp4728-test.png\",alt:\"mcp4728 test\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"For a full tutorial see \",(0,e.jsx)(n.a,{href:\"https://learn.adafruit.com/adafruit-mcp4728-i2c-quad-dac\",children:\"this page\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"handling-midi-messages\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#handling-midi-messages\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Handling MIDI Messages\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`Now that we have 4 12 bit output channels, we can think about how to translate a midi message to voltage.\nTo simplify MIDI handling, we can use the `,(0,e.jsx)(n.a,{href:\"https://www.arduino.cc/en/Reference/MIDIUSB\",children:\"MIDIUSB library\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Taken from \",(0,e.jsx)(n.a,{href:\"https://github.com/arduino-libraries/MIDIUSB/blob/master/examples/MIDIUSB_buzzer/MIDIUSB_buzzer.ino\",children:\"this example\"}),`,\nwe can read incoming midi messages like so:`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"MIDIUSB.h\"'})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"<Adafruit_MCP4728.h>\"})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"<Wire.h>\"})]}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token class-name\",children:\"midiEventPacket_t\"}),\" rx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  rx `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MidiUSB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"header\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//No pending events\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x9\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//pitch\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//velocity\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x8\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOff\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//pitch\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//velocity\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xB\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"controlChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//control\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//value\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"midi-note-to-voltage\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#midi-note-to-voltage\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"MIDI note to Voltage\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the noteOn method, we receive the pitch as MIDI note number:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" midiOffset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" steps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4095\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" octaves \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"max\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"min\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"round\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"steps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"octaves \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" midiOffset\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" steps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// rest of code in last snippet\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we can use the output channel A to control a VCO via MIDI!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"make-it-polyphonic\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#make-it-polyphonic\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Make it polyphonic!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Using the vco micromodules \",(0,e.jsx)(n.a,{href:\"../analog-synthesis\",children:\"introduced in the last post\"}),`,\nwe can create a 3 oscillator setup like this:`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/3vco-simple.png\",alt:\"3vco simple\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Channels A, B and C of the DAC go the the VCOs 1V/oct inputs\"}),`\n`,(0,e.jsx)(n.li,{children:\"Pots allow tuning the oscillators\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"The saw outputs of the oscillators are mixed together using the \",(0,e.jsx)(n.a,{href:\"https://syntaxis.com.pl/en/micromodules/107-umix-481-exp-a.html\",children:\"mix module\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"Digital Pins 4, 5, 6 of the Arduino are connected to the gate of the mix mixodule\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"voice-allocation\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#voice-allocation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Voice Allocation\"]}),`\n`,(0,e.jsx)(n.p,{children:`As we have only 3 oscillators, we need some logic that allocates each of them to incoming notes.\nTo do that, we need the following variables:`}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channels \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// which notes are allocated on which channel, -1 = none\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// which pins correspond to which channel gate\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"In the noteOn method, we can iterate over the pressed array and allocate the first unused channel to the incoming note:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\" channels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      channel `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"When the note is released, we have to revert what we did:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOff\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\" channels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" pitch \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      channel `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`And that's all we need for polyphonic CV messages!\nThis is the starting point to build any paraphonic / polyphonic synth.\nIn the next post, I will expand the above synth to a paraphonic poor mans prophet.`}),`\n`,(0,e.jsxs)(n.h2,{id:\"bonus-is-12-bit-enough-for-pitch-cv\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bonus-is-12-bit-enough-for-pitch-cv\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bonus: Is 12 bit enough for pitch CV?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Some might think now: Is 12 bit anough for \",(0,e.jsx)(n.em,{children:\"true analog output\"}),\"\\u2122 pitch CV? Let's calculate a little bit..\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"With 12 bit, we have 2^12 = 4096 different steps representing voltages from 0 to 5V.\"}),`\n`,(0,e.jsx)(n.li,{children:\"At 1V/oct, we have 5*12 = 60 semitones in the volt range.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Each semitone can be broken down to 100 cents, so we have 6000 cents in our range, giving us 6000/4096 = 1.4 cents per step.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"According to \",(0,e.jsx)(n.a,{href:\"http://hyperphysics.phy-astr.gsu.edu/hbase/Music/cents.html#c4\",children:\"this page\"}),`, the so called \"Just Noticeable Difference\" (JND) in pitch\nperception is around 5 cents.`]}),`\n`,(0,e.jsx)(n.li,{children:\"Having 1.4 cents per step, we are way below the JND.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"So 12 bit should be fine.. (Maybe smaller changes in pitch are perceptible in the context of chords, but that might be topic of another discussion).\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"future-ideas\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#future-ideas\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Future Ideas\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"note stealing\"}),`\n`,(0,e.jsx)(n.li,{children:\"unison mode\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"auto tuning (like bastl 1983) using \",(0,e.jsx)(n.a,{href:\"https://github.com/PaulStoffregen/FreqCount\",children:\"FreqCount\"}),\", \",(0,e.jsx)(n.a,{href:\"https://simple-circuit.com/arduino-frequency-counter-project/\",children:\"also see\"})]}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.soundonsound.com/techniques/introducing-polyphony\",children:\"https://www.soundonsound.com/techniques/introducing-polyphony\"})}),`\n`,(0,e.jsx)(n.li,{children:\"Add MIDI a input jack to be able to play the synth without a computer\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"add MCP4728 to \",(0,e.jsx)(n.a,{href:\"../diy-midi-keyboard\",children:\"keyboard scanner\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"build a eurorack module\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"try using a single dac with demultiplexer and sample and holds \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=Mptm30r0wf8\",children:\"like here\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp\",children:\"https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1\",children:\"https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf\",children:\"https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf\"})}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[\"try using a resistor ladder with a shift register\",`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html\",children:\"https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html\"})}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"similar-devices\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#similar-devices\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Similar Devices\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://mutable-instruments.net/modules/yarns/\",children:\"https://mutable-instruments.net/modules/yarns/\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://bastl-instruments.com/eurorack/modules/1983\",children:\"https://bastl-instruments.com/eurorack/modules/1983\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1\",children:\"https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1\"})}),`\n`]})]});return s?(0,e.jsx)(s,Object.assign({},a,{children:t})):t}var b=f;return y;})();\n;return Component.default;"},"__N_SSG":true}