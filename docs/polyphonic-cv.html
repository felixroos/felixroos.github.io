<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Loophole Letters</title><meta content="This is where felixroos writes about music and coding and stuff that he finds interesting." name="description"/><meta property="og:url" content="https://felixroos.github.io/polyphonic-cv"/><link rel="canonical" href="https://felixroos.github.io/polyphonic-cv"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta property="og:type" content="website"/><meta property="og:site_name" content="Loophole Letters"/><meta property="og:description" content="This is where felixroos writes about music and coding and stuff that he finds interesting."/><meta property="og:title" content="Loophole Letters"/><meta property="og:image" content="https://felixroos.github.io/images/site-preview.png"/><meta name="next-head-count" content="12"/><link rel="preload" href="/_next/static/css/ccf93bd07a0c0324dd11.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ccf93bd07a0c0324dd11.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c5f7f21f8a36ff298cce.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c5f7f21f8a36ff298cce.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-ddd010a953737b6e3536.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-222191e14496d29481e0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91d8f98e791f05bf3a8d.js" defer=""></script><script src="/_next/static/chunks/732-bb8832fe0913704ead3e.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-363d85701650cd2e565b.js" defer=""></script><script src="/_next/static/ePyPdFMoqavchYeC9uh-C/_buildManifest.js" defer=""></script><script src="/_next/static/ePyPdFMoqavchYeC9uh-C/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="z-[1999] sticky top-0 bg-slate-900 font-semibold p-2 text-white flex justify-center shadow-xl border-b border-gray-500"><div class="max-w-3xl w-full text-right p-2"><h1 class="text-3xl"><a href="/">∞ loophole letters</a> </h1></div></header><div class="flex justify-center min-h-full  py-4"> <main class="max-w-3xl p-2"><article class="bg-white prose font-serif max-w-none prose-headings:font-sans prose-headings:font-black prose-headings:text-slate-900"><div class="border-b-4 border-dotted pb-2 border-slate-900 mb-4"><div class="md:flex justify-between"><h1 class="mb-4 ">Polyphonic MIDI to CV</h1><div class="flex space-x-2 items-start pb-4 md:pb-0"><div class="text-sm border bg-slate-200 rounded-md p-2 font-serif">diy</div><div class="text-sm border bg-slate-200 rounded-md p-2 font-serif">synthesis</div><div class="text-sm border bg-slate-200 rounded-md p-2 font-serif">electronics</div></div></div><p class="italic p-0 m-0">May 22, 2021</p></div><div><p>After looking at the basics of analog synthesis in the <a href="../analog-synthesis">last post</a>,
let&#x27;s now look at how to approach polyphony.</p>
<p>So far, I used the Arturia Keystep to send pitch and gate CV to the VCO.
To be able to play multiple notes at once, we need multiple channels of pitch and gate CV.</p>
<h2 id="midi-to-cv"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#midi-to-cv"><span class="icon icon-link"></span></a>MIDI to CV</h2>
<p>Using an Arduino + a DAC (= Digital to Analog Converter), we can set the pitch CV output to an analog voltage whenever a MIDI note message is received:</p>
<p><img src="./img/midi2cv/idea.png" alt="idea"/></p>
<p>The Arduino receives a MIDI note message, calculates the correct voltage for that note and sends the voltage through the DAC to the VCO.</p>
<h2 id="digital-to-analog-conversion"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#digital-to-analog-conversion"><span class="icon icon-link"></span></a>Digital to Analog Conversion</h2>
<p>Without a DAC, an Arudino is not able to produce <em>true analog output</em>™, meaning a voltage that is not either 0V or 5V.</p>
<h3 id="what-about-analogwrite"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#what-about-analogwrite"><span class="icon icon-link"></span></a>What about analogWrite?</h3>
<p>If you&#x27;ve already worked with Arduino, you might know the analogWrite function, which suggests that we output an analog voltage.
But in fact, analogWrite will only output a <a target="_blank" href="https://www.arduino.cc/en/Tutorial/Foundations/PWM">PWM wave</a>, which looks like this:</p>
<p><img src="https://www.arduino.cc/wiki/54ef6da144b4531dd9ada686a7e67c56/pwm.gif" alt="pwm waves"/></p>
<p>So this is still just a digital signal. It can be useful to dim LEDs for example, but it&#x27;s not sufficient for a VCO.</p>
<h3 id="poor-mans-dac"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#poor-mans-dac"><span class="icon icon-link"></span></a>Poor Mans DAC</h3>
<p>What i heard somewhere referred to as the &quot;Poor Mans DAC&quot;, is by filtering the PWM output of the arduino.
This will filter out the higher frequencies of the pulse wave, leaving a more or less mean value.
You can read more about it <a target="_blank" href="https://create.arduino.cc/projecthub/Arduino_Scuola/build-a-simple-dac-for-your-arduino-4c00bd">here</a>.</p>
<p>I tested this too (using a TL074 instead of a TL2451):</p>
<p><img src="./img/midi2cv/poormansdac.png" alt="poor mands dac"/></p>
<p>The problem: In my test, I could only get a voltage range from 1.7V to 4.4V, which only gives us 3 octaves (at 1V/octave) + the resulting voltage was very shaky.</p>
<p>The next thing I tried was a resistor ladder.</p>
<h3 id="resistor-ladder"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#resistor-ladder"><span class="icon icon-link"></span></a>Resistor Ladder</h3>
<p>We can use a bunch of resistors and arrange them to a so called resistor ladder to build a proper DAC:</p>
<p><img src="./img/midi2cv/resistor-ladder-sketch.png" alt="resistor ladder"/></p>
<p>Essentially, we are using a multi layered <a target="_blank" href="https://en.wikipedia.org/wiki/Voltage_divider">Voltage Divider</a>.
The lower row of resistors are 2K and the upper row are 1K.
To read more on how and why it works, I recommend <a target="_blank" href="https://create.arduino.cc/projecthub/instrumentation-system/dac-8-bit-using-r-2r-ladder-964837">this article</a>.</p>
<p>Using this code:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">// value between 0 and 255</span>
  <span class="token keyword">int</span> bits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bits<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> digit <span class="token operator">=</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> digit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The value can be set between 0 and 255 (= 256 values = 2^8 = 8 bit DAC).
If we measure the voltage, we get approximately 2.5V for 127:</p>
<p><img src="./img/midi2cv/resistor-ladder.png" alt="resistor ladder"/></p>
<p>Let&#x27;s step up the game once more and look at an even better solution, as we would quickly run out of
output pins if we built our multi channel dac with resistor ladders.</p>
<h3 id="using-the-mcp4728"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#using-the-mcp4728"><span class="icon icon-link"></span></a>Using the MCP4728</h3>
<p>Using an IC DAC, like the MCP4728, we can have 4 channel <em>true analog output</em>™ without using zillions of pins.
The integration is really easy with a breakout board, like the one from Adafruit:</p>
<p><img src="./img/midi2cv/mcp4728-sketch.png" alt="mcp4728"/></p>
<p>Code:</p>
<pre class="language-c"><code class="language-c"><span class="token comment">// Basic demo for configuring the MCP4728 4-Channel 12-bit I2C DAC</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_MCP4728.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Wire.h&gt;</span></span>

Adafruit_MCP4728 mcp<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>Serial<span class="token punctuation">)</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will pause Zero, Leonardo, etc until serial console opens</span>

  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Adafruit MCP4728 test!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Try to initialize!</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mcp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to find MCP4728 chip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>MCP4728_CHANNEL_A<span class="token punctuation">,</span> <span class="token number">4095</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>MCP4728_CHANNEL_B<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>MCP4728_CHANNEL_C<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>MCP4728_CHANNEL_D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
<p>Reading Channel B:</p>
<p><img src="./img/midi2cv/mcp4728-test.png" alt="mcp4728 test"/></p>
<p>For a full tutorial see <a target="_blank" href="https://learn.adafruit.com/adafruit-mcp4728-i2c-quad-dac">this page</a>.</p>
<h2 id="handling-midi-messages"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#handling-midi-messages"><span class="icon icon-link"></span></a>Handling MIDI Messages</h2>
<p>Now that we have 4 12 bit output channels, we can think about how to translate a midi message to voltage.
To simplify MIDI handling, we can use the <a target="_blank" href="https://www.arduino.cc/en/Reference/MIDIUSB">MIDIUSB library</a>.</p>
<p>Taken from <a target="_blank" href="https://github.com/arduino-libraries/MIDIUSB/blob/master/examples/MIDIUSB_buzzer/MIDIUSB_buzzer.ino">this example</a>,
we can read incoming midi messages like so:</p>
<pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;MIDIUSB.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_MCP4728.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Wire.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">midiEventPacket_t</span> rx<span class="token punctuation">;</span>
  rx <span class="token operator">=</span> MidiUSB<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>rx<span class="token punctuation">.</span>header<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//No pending events</span>

    <span class="token keyword">case</span> <span class="token number">0x9</span><span class="token operator">:</span>
      <span class="token function">noteOn</span><span class="token punctuation">(</span>
        rx<span class="token punctuation">.</span>byte1 <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">,</span>  <span class="token comment">//channel</span>
        rx<span class="token punctuation">.</span>byte2<span class="token punctuation">,</span>        <span class="token comment">//pitch</span>
        rx<span class="token punctuation">.</span>byte3         <span class="token comment">//velocity</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token number">0x8</span><span class="token operator">:</span>
      <span class="token function">noteOff</span><span class="token punctuation">(</span>
        rx<span class="token punctuation">.</span>byte1 <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">,</span>  <span class="token comment">//channel</span>
        rx<span class="token punctuation">.</span>byte2<span class="token punctuation">,</span>        <span class="token comment">//pitch</span>
        rx<span class="token punctuation">.</span>byte3         <span class="token comment">//velocity</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token number">0xB</span><span class="token operator">:</span>
      <span class="token function">controlChange</span><span class="token punctuation">(</span>
        rx<span class="token punctuation">.</span>byte1 <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">,</span>  <span class="token comment">//channel</span>
        rx<span class="token punctuation">.</span>byte2<span class="token punctuation">,</span>        <span class="token comment">//control</span>
        rx<span class="token punctuation">.</span>byte3         <span class="token comment">//value</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="midi-note-to-voltage"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#midi-note-to-voltage"><span class="icon icon-link"></span></a>MIDI note to Voltage</h3>
<p>In the noteOn method, we receive the pitch as MIDI note number:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">int</span> midiOffset <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">getStep</span><span class="token punctuation">(</span>byte pitch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token number">4095</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> octaves <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span>steps <span class="token operator">/</span> <span class="token punctuation">(</span>octaves <span class="token operator">*</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>pitch <span class="token operator">-</span> midiOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> steps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">noteOn</span><span class="token punctuation">(</span>byte midiChannel<span class="token punctuation">,</span> byte pitch<span class="token punctuation">,</span> byte velocity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>MCP4728_CHANNEL_A<span class="token punctuation">,</span> <span class="token function">getStep</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// rest of code in last snippet</span>
</code></pre>
<p>Now we can use the output channel A to control a VCO via MIDI!</p>
<h2 id="make-it-polyphonic"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#make-it-polyphonic"><span class="icon icon-link"></span></a>Make it polyphonic!</h2>
<p>Using the vco micromodules <a href="../analog-synthesis">introduced in the last post</a>,
we can create a 3 oscillator setup like this:</p>
<p><img src="./img/midi2cv/3vco-simple.png" alt="3vco simple"/></p>
<ul>
<li>Channels A, B and C of the DAC go the the VCOs 1V/oct inputs</li>
<li>Pots allow tuning the oscillators</li>
<li>The saw outputs of the oscillators are mixed together using the <a target="_blank" href="https://syntaxis.com.pl/en/micromodules/107-umix-481-exp-a.html">mix module</a></li>
<li>Digital Pins 4, 5, 6 of the Arduino are connected to the gate of the mix mixodule</li>
</ul>
<h3 id="voice-allocation"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#voice-allocation"><span class="icon icon-link"></span></a>Voice Allocation</h3>
<p>As we have only 3 oscillators, we need some logic that allocates each of them to incoming notes.
To do that, we need the following variables:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">int</span> channels <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> pressed<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// which notes are allocated on which channel, -1 = none</span>
<span class="token keyword">int</span> gates<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// which pins correspond to which channel gate</span>
</code></pre>
<p>In the noteOn method, we can iterate over the pressed array and allocate the first unused channel to the incoming note:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">noteOn</span><span class="token punctuation">(</span>byte midiChannel<span class="token punctuation">,</span> byte pitch<span class="token punctuation">,</span> byte velocity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> channel <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> channels<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pressed<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> channel <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      channel <span class="token operator">=</span> i<span class="token punctuation">;</span>
      pressed<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pitch<span class="token punctuation">;</span>
      <span class="token function">digitalWrite</span><span class="token punctuation">(</span>gates<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
      mcp<span class="token punctuation">.</span><span class="token function">setChannelValue</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token function">getStep</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>When the note is released, we have to revert what we did:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">noteOff</span><span class="token punctuation">(</span>byte midiChannel<span class="token punctuation">,</span> byte pitch<span class="token punctuation">,</span> byte velocity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> channel <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> channels<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pressed<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> pitch <span class="token operator">&amp;&amp;</span> channel <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      channel <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token function">digitalWrite</span><span class="token punctuation">(</span>gates<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pressed<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And that&#x27;s all we need for polyphonic CV messages!
This is the starting point to build any paraphonic / polyphonic synth.
In the next post, I will expand the above synth to a paraphonic poor mans prophet.</p>
<h2 id="bonus-is-12-bit-enough-for-pitch-cv"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#bonus-is-12-bit-enough-for-pitch-cv"><span class="icon icon-link"></span></a>Bonus: Is 12 bit enough for pitch CV?</h2>
<p>Some might think now: Is 12 bit anough for <em>true analog output</em>™ pitch CV? Let&#x27;s calculate a little bit..</p>
<ul>
<li>With 12 bit, we have 2^12 = 4096 different steps representing voltages from 0 to 5V.</li>
<li>At 1V/oct, we have 5*12 = 60 semitones in the volt range.</li>
<li>Each semitone can be broken down to 100 cents, so we have 6000 cents in our range, giving us 6000/4096 = 1.4 cents per step.</li>
<li>According to <a target="_blank" href="http://hyperphysics.phy-astr.gsu.edu/hbase/Music/cents.html#c4">this page</a>, the so called &quot;Just Noticeable Difference&quot; (JND) in pitch
perception is around 5 cents.</li>
<li>Having 1.4 cents per step, we are way below the JND.</li>
</ul>
<p>So 12 bit should be fine.. (Maybe smaller changes in pitch are perceptible in the context of chords, but that might be topic of another discussion).</p>
<h2 id="future-ideas"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#future-ideas"><span class="icon icon-link"></span></a>Future Ideas</h2>
<ul>
<li>note stealing</li>
<li>unison mode</li>
<li>auto tuning (like bastl 1983) using <a target="_blank" href="https://github.com/PaulStoffregen/FreqCount">FreqCount</a>, <a target="_blank" href="https://simple-circuit.com/arduino-frequency-counter-project/">also see</a></li>
<li><a target="_blank" href="https://www.soundonsound.com/techniques/introducing-polyphony">https://www.soundonsound.com/techniques/introducing-polyphony</a></li>
<li>Add MIDI a input jack to be able to play the synth without a computer</li>
<li>add MCP4728 to <a href="../diy-midi-keyboard">keyboard scanner</a></li>
<li>build a eurorack module</li>
<li>try using a single dac with demultiplexer and sample and holds <a target="_blank" href="https://www.youtube.com/watch?v=Mptm30r0wf8">like here</a>
<ul>
<li><a target="_blank" href="https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp">https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp</a></li>
<li><a target="_blank" href="https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1">https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1</a></li>
<li><a target="_blank" href="https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf">https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf</a></li>
</ul>
</li>
<li>try using a resistor ladder with a shift register<!-- -->
<ul>
<li><a target="_blank" href="https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html">https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html</a></li>
</ul>
</li>
</ul>
<h2 id="similar-devices"><a aria-hidden="true" tabindex="-1" href="/polyphonic-cv#similar-devices"><span class="icon icon-link"></span></a>Similar Devices</h2>
<ul>
<li><a target="_blank" href="https://mutable-instruments.net/modules/yarns/">https://mutable-instruments.net/modules/yarns/</a></li>
<li><a target="_blank" href="https://bastl-instruments.com/eurorack/modules/1983">https://bastl-instruments.com/eurorack/modules/1983</a></li>
<li><a target="_blank" href="https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1">https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1</a></li>
</ul></div></article></main></div><div class="py-4 font-serif bg-slate-400 flex justify-center items-center"><p class="leading-none"><a class="underline" href="https://github.com/felixroos">Felix Roos</a> <!-- -->2021</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Polyphonic MIDI to CV","date":"2021-05-22","tags":["diy","synthesis","electronics"],"description":"After looking at the basics of analog synthesis in the last post let's now look at how to approach polyphony.","image":"./img/MCP4728.png"},"code":"var Component=(()=\u003e{var r=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=\u003ec(a,\"__esModule\",{value:!0});var m=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),k=(a,n)=\u003e{i(a);for(var s in n)c(a,s,{get:n[s],enumerable:!0})},N=(a,n,s)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let t of d(n))!u.call(a,t)\u0026\u0026t!==\"default\"\u0026\u0026c(a,t,{get:()=\u003en[t],enumerable:!(s=p(n,t))||s.enumerable});return a},g=a=\u003eN(i(c(a!=null?r(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((C,l)=\u003e{l.exports=_jsx_runtime});var y={};k(y,{default:()=\u003eb,frontmatter:()=\u003ew});var e=g(o()),w={title:\"Polyphonic MIDI to CV\",date:\"2021-05-22\",tags:[\"diy\",\"synthesis\",\"electronics\"],description:\"After looking at the basics of analog synthesis in the last post let's now look at how to approach polyphony.\",image:\"./img/MCP4728.png\"};function f(a){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",img:\"img\",em:\"em\",h3:\"h3\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\"},a.components),{wrapper:s}=n,t=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"After looking at the basics of analog synthesis in the \",(0,e.jsx)(n.a,{href:\"../analog-synthesis\",children:\"last post\"}),`,\nlet's now look at how to approach polyphony.`]}),`\n`,(0,e.jsx)(n.p,{children:`So far, I used the Arturia Keystep to send pitch and gate CV to the VCO.\nTo be able to play multiple notes at once, we need multiple channels of pitch and gate CV.`}),`\n`,(0,e.jsxs)(n.h2,{id:\"midi-to-cv\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#midi-to-cv\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"MIDI to CV\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Using an Arduino + a DAC (= Digital to Analog Converter), we can set the pitch CV output to an analog voltage whenever a MIDI note message is received:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/idea.png\",alt:\"idea\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The Arduino receives a MIDI note message, calculates the correct voltage for that note and sends the voltage through the DAC to the VCO.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"digital-to-analog-conversion\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#digital-to-analog-conversion\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Digital to Analog Conversion\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Without a DAC, an Arudino is not able to produce \",(0,e.jsx)(n.em,{children:\"true analog output\"}),\"\\u2122, meaning a voltage that is not either 0V or 5V.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"what-about-analogwrite\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-about-analogwrite\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What about analogWrite?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`If you've already worked with Arduino, you might know the analogWrite function, which suggests that we output an analog voltage.\nBut in fact, analogWrite will only output a `,(0,e.jsx)(n.a,{href:\"https://www.arduino.cc/en/Tutorial/Foundations/PWM\",children:\"PWM wave\"}),\", which looks like this:\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"https://www.arduino.cc/wiki/54ef6da144b4531dd9ada686a7e67c56/pwm.gif\",alt:\"pwm waves\"})}),`\n`,(0,e.jsx)(n.p,{children:\"So this is still just a digital signal. It can be useful to dim LEDs for example, but it's not sufficient for a VCO.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"poor-mans-dac\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#poor-mans-dac\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Poor Mans DAC\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`What i heard somewhere referred to as the \"Poor Mans DAC\", is by filtering the PWM output of the arduino.\nThis will filter out the higher frequencies of the pulse wave, leaving a more or less mean value.\nYou can read more about it `,(0,e.jsx)(n.a,{href:\"https://create.arduino.cc/projecthub/Arduino_Scuola/build-a-simple-dac-for-your-arduino-4c00bd\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"I tested this too (using a TL074 instead of a TL2451):\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/poormansdac.png\",alt:\"poor mands dac\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The problem: In my test, I could only get a voltage range from 1.7V to 4.4V, which only gives us 3 octaves (at 1V/octave) + the resulting voltage was very shaky.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The next thing I tried was a resistor ladder.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"resistor-ladder\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#resistor-ladder\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Resistor Ladder\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can use a bunch of resistors and arrange them to a so called resistor ladder to build a proper DAC:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/resistor-ladder-sketch.png\",alt:\"resistor ladder\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Essentially, we are using a multi layered \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Voltage_divider\",children:\"Voltage Divider\"}),`.\nThe lower row of resistors are 2K and the upper row are 1K.\nTo read more on how and why it works, I recommend `,(0,e.jsx)(n.a,{href:\"https://create.arduino.cc/projecthub/instrumentation-system/dac-8-bit-using-r-2r-ladder-964837\",children:\"this article\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Using this code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" value \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// value between 0 and 255\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" bits \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" bits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" digit \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" digit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`The value can be set between 0 and 255 (= 256 values = 2^8 = 8 bit DAC).\nIf we measure the voltage, we get approximately 2.5V for 127:`}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/resistor-ladder.png\",alt:\"resistor ladder\"})}),`\n`,(0,e.jsx)(n.p,{children:`Let's step up the game once more and look at an even better solution, as we would quickly run out of\noutput pins if we built our multi channel dac with resistor ladders.`}),`\n`,(0,e.jsxs)(n.h3,{id:\"using-the-mcp4728\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#using-the-mcp4728\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Using the MCP4728\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Using an IC DAC, like the MCP4728, we can have 4 channel \",(0,e.jsx)(n.em,{children:\"true analog output\"}),`\\u2122 without using zillions of pins.\nThe integration is really easy with a breakout board, like the one from Adafruit:`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/mcp4728-sketch.png\",alt:\"mcp4728\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Basic demo for configuring the MCP4728 4-Channel 12-bit I2C DAC\"}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\u003cAdafruit_MCP4728.h\u003e\"})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\u003cWire.h\u003e\"})]}),`\n\nAdafruit_MCP4728 mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"begin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"115200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"Serial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// will pause Zero, Leonardo, etc until serial console opens\"}),`\n\n  Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Adafruit MCP4728 test!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Try to initialize!\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"mcp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"begin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Failed to find MCP4728 chip\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4095\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_B\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2048\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_C\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1024\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_D\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"delay\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"Reading Channel B:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/mcp4728-test.png\",alt:\"mcp4728 test\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"For a full tutorial see \",(0,e.jsx)(n.a,{href:\"https://learn.adafruit.com/adafruit-mcp4728-i2c-quad-dac\",children:\"this page\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"handling-midi-messages\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#handling-midi-messages\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Handling MIDI Messages\"]}),`\n`,(0,e.jsxs)(n.p,{children:[`Now that we have 4 12 bit output channels, we can think about how to translate a midi message to voltage.\nTo simplify MIDI handling, we can use the `,(0,e.jsx)(n.a,{href:\"https://www.arduino.cc/en/Reference/MIDIUSB\",children:\"MIDIUSB library\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Taken from \",(0,e.jsx)(n.a,{href:\"https://github.com/arduino-libraries/MIDIUSB/blob/master/examples/MIDIUSB_buzzer/MIDIUSB_buzzer.ino\",children:\"this example\"}),`,\nwe can read incoming midi messages like so:`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"MIDIUSB.h\"'})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\u003cAdafruit_MCP4728.h\u003e\"})]}),`\n`,(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"include\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\u003cWire.h\u003e\"})]}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token class-name\",children:\"midiEventPacket_t\"}),\" rx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  rx `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MidiUSB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"switch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"header\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//No pending events\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x9\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//pitch\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//velocity\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x8\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOff\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//pitch\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//velocity\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xB\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"controlChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//channel\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//control\"}),`\n        rx`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"byte3         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//value\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"midi-note-to-voltage\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#midi-note-to-voltage\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"MIDI note to Voltage\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the noteOn method, we receive the pitch as MIDI note number:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" midiOffset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" steps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4095\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" octaves \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"max\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"min\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"round\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"steps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"octaves \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" midiOffset\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" steps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MCP4728_CHANNEL_A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// rest of code in last snippet\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we can use the output channel A to control a VCO via MIDI!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"make-it-polyphonic\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#make-it-polyphonic\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Make it polyphonic!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Using the vco micromodules \",(0,e.jsx)(n.a,{href:\"../analog-synthesis\",children:\"introduced in the last post\"}),`,\nwe can create a 3 oscillator setup like this:`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/midi2cv/3vco-simple.png\",alt:\"3vco simple\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Channels A, B and C of the DAC go the the VCOs 1V/oct inputs\"}),`\n`,(0,e.jsx)(n.li,{children:\"Pots allow tuning the oscillators\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"The saw outputs of the oscillators are mixed together using the \",(0,e.jsx)(n.a,{href:\"https://syntaxis.com.pl/en/micromodules/107-umix-481-exp-a.html\",children:\"mix module\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"Digital Pins 4, 5, 6 of the Arduino are connected to the gate of the mix mixodule\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"voice-allocation\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#voice-allocation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Voice Allocation\"]}),`\n`,(0,e.jsx)(n.p,{children:`As we have only 3 oscillators, we need some logic that allocates each of them to incoming notes.\nTo do that, we need the following variables:`}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channels \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// which notes are allocated on which channel, -1 = none\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// which pins correspond to which channel gate\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"In the noteOn method, we can iterate over the pressed array and allocate the first unused channel to the incoming note:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" channels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      channel `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      mcp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setChannelValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getStep\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"When the note is released, we have to revert what we did:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOff\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"byte midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte pitch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" byte velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" channels\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" pitch \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" channel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      channel `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"gates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`And that's all we need for polyphonic CV messages!\nThis is the starting point to build any paraphonic / polyphonic synth.\nIn the next post, I will expand the above synth to a paraphonic poor mans prophet.`}),`\n`,(0,e.jsxs)(n.h2,{id:\"bonus-is-12-bit-enough-for-pitch-cv\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bonus-is-12-bit-enough-for-pitch-cv\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bonus: Is 12 bit enough for pitch CV?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Some might think now: Is 12 bit anough for \",(0,e.jsx)(n.em,{children:\"true analog output\"}),\"\\u2122 pitch CV? Let's calculate a little bit..\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"With 12 bit, we have 2^12 = 4096 different steps representing voltages from 0 to 5V.\"}),`\n`,(0,e.jsx)(n.li,{children:\"At 1V/oct, we have 5*12 = 60 semitones in the volt range.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Each semitone can be broken down to 100 cents, so we have 6000 cents in our range, giving us 6000/4096 = 1.4 cents per step.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"According to \",(0,e.jsx)(n.a,{href:\"http://hyperphysics.phy-astr.gsu.edu/hbase/Music/cents.html#c4\",children:\"this page\"}),`, the so called \"Just Noticeable Difference\" (JND) in pitch\nperception is around 5 cents.`]}),`\n`,(0,e.jsx)(n.li,{children:\"Having 1.4 cents per step, we are way below the JND.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"So 12 bit should be fine.. (Maybe smaller changes in pitch are perceptible in the context of chords, but that might be topic of another discussion).\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"future-ideas\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#future-ideas\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Future Ideas\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"note stealing\"}),`\n`,(0,e.jsx)(n.li,{children:\"unison mode\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"auto tuning (like bastl 1983) using \",(0,e.jsx)(n.a,{href:\"https://github.com/PaulStoffregen/FreqCount\",children:\"FreqCount\"}),\", \",(0,e.jsx)(n.a,{href:\"https://simple-circuit.com/arduino-frequency-counter-project/\",children:\"also see\"})]}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.soundonsound.com/techniques/introducing-polyphony\",children:\"https://www.soundonsound.com/techniques/introducing-polyphony\"})}),`\n`,(0,e.jsx)(n.li,{children:\"Add MIDI a input jack to be able to play the synth without a computer\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"add MCP4728 to \",(0,e.jsx)(n.a,{href:\"../diy-midi-keyboard\",children:\"keyboard scanner\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"build a eurorack module\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"try using a single dac with demultiplexer and sample and holds \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=Mptm30r0wf8\",children:\"like here\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp\",children:\"https://circuitdigest.com/electronic-circuits/sample-and-hold-circuit-op-amp\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1\",children:\"https://www.reichelt.de/fr/de/sample-and-hold-ic-1-kanal-dip-8-lf-398-dip-p10279.html?r=1\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf\",children:\"https://www.analog.com/media/en/technical-documentation/data-sheets/AD585.pdf\"})}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[\"try using a resistor ladder with a shift register\",`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html\",children:\"https://www.conrad.de/de/ratgeber/handwerk-industrie-wiki/elektronik-bauteile/74hc595.html\"})}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"similar-devices\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#similar-devices\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Similar Devices\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://mutable-instruments.net/modules/yarns/\",children:\"https://mutable-instruments.net/modules/yarns/\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://bastl-instruments.com/eurorack/modules/1983\",children:\"https://bastl-instruments.com/eurorack/modules/1983\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1\",children:\"https://github.com/joeSeggiola/arduino-eurorack-projects/tree/master/midi4plus1\"})}),`\n`]})]});return s?(0,e.jsx)(s,Object.assign({},a,{children:t})):t}var b=f;return y;})();\n;return Component.default;"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"polyphonic-cv"},"buildId":"ePyPdFMoqavchYeC9uh-C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>