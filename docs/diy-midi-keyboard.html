<!DOCTYPE html><html lang="en"><head><link rel="alternate" type="application/rss+xml" title="RSS Feed for felixroos.github.io" href="/rss.xml"/><link rel="alternate" type="application/atom+xml" title="Atom Feed for felixroos.github.io" href="/atom.xml"/><link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon-180x180.png"/><link rel="shortcut icon" type="image/x-icon" href="favicon/favicon-32x32.ico"/><link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png"/><meta name="msapplication-square310x310logo" content="favicon/mstile-310x310.png"/><meta name="msapplication-TileColor" content="#FFFFFF"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem("theme");if(e){d.add(e)}else{d.add('light');}}catch(t){}}();</script><title>Loophole Letters</title><meta content="This is where felixroos writes about music and coding and stuff that he finds interesting." name="description"/><meta property="og:url" content="https://felixroos.github.io/diy-midi-keyboard"/><link rel="canonical" href="https://felixroos.github.io/diy-midi-keyboard"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta property="og:type" content="website"/><meta property="og:site_name" content="Loophole Letters"/><meta property="og:description" content="This is where felixroos writes about music and coding and stuff that he finds interesting."/><meta property="og:title" content="Loophole Letters"/><meta property="og:image" content="https://felixroos.github.io/images/site-preview.png"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/c1bc883e121b9524.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c1bc883e121b9524.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-e146e0a21859bb55.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9ff8c4d1705cde6c.js" defer=""></script><script src="/_next/static/chunks/637-8750e2fd8170d64d.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-effc0480c90c08b8.js" defer=""></script><script src="/_next/static/iXthh_4XGgKtotftD4wfY/_buildManifest.js" defer=""></script><script src="/_next/static/iXthh_4XGgKtotftD4wfY/_ssgManifest.js" defer=""></script><script src="/_next/static/iXthh_4XGgKtotftD4wfY/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="z-[1999] sticky top-0 bg-slate-900 dark:bg-slate-800 font-semibold p-2 text-white flex justify-center shadow-xl border-b border-gray-500 dark:border-gray-800"><div class="max-w-3xl w-full p-2 flex justify-between items-center"><h1 class="text-3xl"><a href="/" class="flex items-bottom"><img src="./logo_cropped.png" class="h-8 mr-3"/>loophole letters</a> </h1></div></header><div class="flex justify-center min-h-full dark:bg-slate-900 py-4"> <main class="max-w-3xl p-2"><article class="prose font-serif max-w-none prose-headings:font-sans prose-headings:font-black prose-headings:text-slate-900 dark:prose-headings:text-gray-200 dark:text-gray-400 dark:prose-strong:text-gray-400 dark:prose-code:text-slate-400 dark:prose-a:text-gray-300 prose-a:text-slate-900 prose-blockquote:text-slate-800 dark:prose-blockquote:text-slate-400"><div class="border-b-4 border-dotted pb-2 border-slate-900 mb-4"><div class="md:flex justify-between"><h1 class="mb-4 ">DIY MIDI Keyboard Scanner</h1><div class="flex space-x-2 items-start pb-4 md:pb-0"><div class="text-sm bg-slate-200 dark:bg-slate-700 rounded-md p-2 font-serif text-slate-900 dark:text-white">diy</div><div class="text-sm bg-slate-200 dark:bg-slate-700 rounded-md p-2 font-serif text-slate-900 dark:text-white">electronics</div></div></div><p class="italic p-0 m-0">February 11, 2021</p></div><div><p><img src="./img/maudio49/arduino-keystation49.png" alt="keystation 49"/></p>
<p>After the <a href="../midimoog/">Minimoog MIDI Controller</a>, here comes another electronics project I did a few days ago.
As I had a <a target="_blank" href="https://m-audio.de/keystation-88-mkii">M Audio Keystation 88 MkII</a> laying around that I had replaced with a better master keyboard,
I decided to tear it open and look inside..</p>
<h2 id="1-how-a-midi-keyboard-looks-inside"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#1-how-a-midi-keyboard-looks-inside"><span class="icon icon-link"></span></a>1. How a MIDI Keyboard looks inside</h2>
<p>The first step was dissassembling all the parts and understanding how they work. I cannot speak for all MIDI Keyboards, but I suppose they all work in a similar way.</p>
<p>After removing the case, this is how the keybed looks like:</p>
<p><img src="./img/maudio49/keybed.png" alt="keybed"/></p>
<p>The little green pcb holds a microcontroller, which controls the keybed:</p>
<p><img src="./img/maudio49/control-pcb.png" alt="control pcb"/></p>
<p>Looking from the side, we can see plastic fins that push down buttons when keys are pressed:</p>
<p><img src="./img/maudio49/switch.jpeg" alt="switch"/></p>
<p>To get a better view, I removed the pcb from the keybed and took a closer look at the buttons:</p>
<p><img src="./img/maudio49/switch-inside.jpeg" alt="switch inside"/></p>
<p>Inside each button, there are two circles with conductive ink above a conductive ink pad that is interrupted by a snake shaped gap.
If the buttons are pressed, the circles bridge the gap, connecting the left and right inputs. Long story short, these are switches.</p>
<h3 id="why-are-there-two-switches-per-key"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#why-are-there-two-switches-per-key"><span class="icon icon-link"></span></a>Why are there two switches per key?</h3>
<p>There are two switches per key to be able to measure the velocity of the keystroke.
As one circle is slightly more elevated, it will make a connection a little earlier, before the less elevated one.
The time between the connections can be used to tell the velocity (smaller time = higher velocity).</p>
<h2 id="2-analyzing-the-pcb"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#2-analyzing-the-pcb"><span class="icon icon-link"></span></a>2. Analyzing the PCB</h2>
<p>To find out what is going on, I needed to look at the pcb. For all 88 keys, there are 2 pcbs, where one has 49 and the other 39 keys.
From this point, I decided to work with only 49 keys, as it is more handy.</p>
<p>Taking a closer look, we can see many diodes on the plastic side:</p>
<p><img src="./img/maudio49/diodes.png" alt="diodes"/></p>
<p>I took pictures of the other (more interesting) side of the pcb, stitched them together and then redrew the copper lines above the photo:</p>
<div style="display:flex;height:500px;width:600px;overflow:auto"><div style="width:300px;height:1000px"><img alt="pcb photo" src="./img/maudio49/pcb_photo.png"/></div><div style="width:300px;height:1000px"><img alt="pcb drawn" src="./img/maudio49/pcb_drawing.png"/></div></div>
<p>From the right image, I then created a more overseeable schematic,
which is not constrained by pcb dimensions:</p>
<p><img src="./img/maudio49/pcb_schematic_flipped.png" alt="schematic"/></p>
<p>The schematic unveils a logical arrangement of connections that is known as a <a target="_blank" href="https://en.wikipedia.org/wiki/Keyboard_matrix_circuit">Keyboard Matrix</a>.</p>
<h3 id="keyboard-matrix"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#keyboard-matrix"><span class="icon icon-link"></span></a>Keyboard Matrix</h3>
<p>The above arrangement of wiring makes it possible to have much less pins than keys.
Here, we have only 21 pins for 96 switches (2 switches for each of the 49 keys).
If we did not use a keyboard matrix, we could just connect each switch directly the microcontroller,
but that would cost us 96 pins..</p>
<p>The 21 pins are connected via 2 plugs with 9 and 12 pins.
As we can tell from the direction of the diodes, the current must flow from the 9 pin connector the the 12 pin connector,
as a diode only allows current flowing in one direction (direction of arrow).</p>
<p>Now, the idea of the keyboard matrix is this: If we activate only one input pin,
the output pins that will be active let us decipher exactly which keys are pressed.
As we have 9 input pins and 12 output pins, we have a total of 9*12 = 108 possible combinations,
which is more than enough for our 96 switches.</p>
<p>Example: If we activate input pin 3, output pin 2 will be active if switch 8A is pressed (A = first, B = second switch).
We can verify that by looking at the schematic:</p>
<p><img src="./img/maudio49/example-connection.png" alt="example connection"/></p>
<p>To get a better overview, we can create a table to show which combination of pins corresponds to which key switch:</p>
<p><img src="./img/maudio49/matrix-table.png" alt="matrix table"/></p>
<p>Of course, the values of this table will depend on the keyboard model, but the structure should be the same.</p>
<h3 id="verifying-the-matrix-table"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#verifying-the-matrix-table"><span class="icon icon-link"></span></a>Verifying the Matrix Table</h3>
<p>To verify that I am on the track, I used a multimeter in diode testing mode and connected the plus side to an input pin and the minus side to an output pin.
Pressing the key that corresponds to the pin combination should then make a connection, while others do nothing.
I was quite happy to find out everything behaved as expected.</p>
<h3 id="what-a-keyboard-scanner-does"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#what-a-keyboard-scanner-does"><span class="icon icon-link"></span></a>What a Keyboard Scanner does</h3>
<p>Now that we know how the keyboard matrix works, we can start to think of how to handle it.
In the end, we want a midi signal each time a key is pressed (note on) and depressed (note off).
This task is handled by the keyboard scanner, which is a microcontroller that repeatedly tests all pin combinations very quickly.
If a test for a particular combination is positive, a midi signal is sent for the key corresponding to that combination.</p>
<h2 id="3-arduino-keyboard-scanner"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#3-arduino-keyboard-scanner"><span class="icon icon-link"></span></a>3. Arduino Keyboard Scanner</h2>
<p>As the already existing microcontroller is a black box, let&#x27;s wire up our own keyboard scanner with an Arduino Micro.
The Arduino Micro is perfect for that task, as it acts as a class compliant USB device.</p>
<p>The only problem: The Arduino Micro only has 20 input pins, but we need 21 for our 49 keys.
To fix that, we can use multiplexers, like already used <a href="../midimoog/#analog-input-multiplexing">for the midimoog</a>.</p>
<h3 id="schematic"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#schematic"><span class="icon icon-link"></span></a>Schematic</h3>
<p>This time, I started soldering without a plan (not recommended), but drew the &quot;schematic&quot; afterwards:</p>
<p><img src="./img/maudio49/scanner-schematic.png" alt="scanner schematic"/></p>
<p>I did not explicitly draw all connections, this is the meaning of the colors:</p>
<ul>
<li>red is 5V</li>
<li>black is ground</li>
<li>gray numbers are keybed pins (top ic goes to input pins, bottom ics go to output pins)</li>
<li>blue are the select pins / cables</li>
<li>yellow is the input</li>
<li>green are the outputs</li>
</ul>
<h3 id="soldering"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#soldering"><span class="icon icon-link"></span></a>Soldering</h3>
<p>After soldering it all together, the connected board board looked like this:</p>
<p><img src="./img/maudio49/arduino-scanner-pcb.png" alt="scanner pcb"/></p>
<h3 id="code"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#code"><span class="icon icon-link"></span></a>Code</h3>
<p>The basic idea of how to check if a key is pressed goes like this:</p>
<pre class="language-c"><code class="language-c"><span class="token comment">// send voltage to input pin</span>
<span class="token function">digitalWrite</span><span class="token punctuation">(</span>inputPin<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>outputPin<span class="token punctuation">)</span> <span class="token operator">==</span> HIGH<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// key is pressed =&gt; send midi or whatever</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The Problem: If a key is NOT pressed, the output pin might still be HIGH if it is not connected to ground with a pulldown resistor,
as it is &quot;hanging in mid air&quot;. When I realized that, I already soldered everything together..</p>
<p>Luckily, Arduino comes with <a target="_blank" href="https://www.arduino.cc/en/Tutorial/DigitalInputPullup">internal pullup resistors</a>.
This makes soldering resistors to each input obsolete. But, unluckily, there are no internal pulldown resistors, which means we have to flip the logic:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span>outputPin<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span>inputPin<span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>inputPin<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pullup</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// send output pin LOW</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>outputPin<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>inputPin<span class="token punctuation">)</span> <span class="token operator">==</span> LOW<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// key is pressed =&gt; send midi or whatever</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It took me a while to find this trick, but it makes sense:
Instead of setting an output HIGH, we set the input LOW, which results in the current keep flowing through the diodes in the right direction.</p>
<p>Now, here is the code with all the correct ins and outs, according to the schematic:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//select pins</span>
  <span class="token comment">// ABC of INPUT</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ABC of OUTPUTs</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// gray</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pullup</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> INPUT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yellow</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pullup</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// green</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// green</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">set4051</span><span class="token punctuation">(</span><span class="token keyword">int</span> pinA<span class="token punctuation">,</span> <span class="token keyword">int</span> pinB<span class="token punctuation">,</span> <span class="token keyword">int</span> pinC<span class="token punctuation">,</span> <span class="token keyword">int</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// A = least significant bit</span>
  <span class="token comment">// bitRead also starts from least significant bit</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>pinA<span class="token punctuation">,</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>pinB<span class="token punctuation">,</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>pinC<span class="token punctuation">,</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// loop through all switches (98 = 49 * 2)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">98</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> k <span class="token operator">/</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// values between 0 to 8 (input pins)</span>
    <span class="token keyword">int</span> o <span class="token operator">=</span> k <span class="token operator">%</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// values between 0 and 11 (output pins)</span>
    <span class="token comment">// use input pin 5 for i == 8</span>
    <span class="token keyword">int</span> readPin <span class="token operator">=</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">6</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token function">set4051</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// select input channel</span>
    <span class="token function">set4051</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// select output channel</span>
    <span class="token comment">// use output 7 for o &lt; 8 and output 8 for o &gt;= 8</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token function">bitRead</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token function">bitRead</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>readPin<span class="token punctuation">)</span> <span class="token operator">==</span> LOW<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// connected</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With this code, the serial monitor will print number k everytime a key is pressed.
This prevents us from the total brainfuck of thinking through which combination of inputs and outputs lead to which key.</p>
<p>All we have to do is press each key lightly first (switch A), then to the bottom (switch B) and write the logged numbers to a list.
For my wiring, the list looks like this:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">int</span> keys<span class="token punctuation">[</span><span class="token number">98</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span>
  <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span>
  <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span>
  <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span>
  <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span>
  <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span>
  <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span>
  <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span>
  <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span>
  <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span>
  <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span>
  <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span>
  <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span>
  <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span>
  <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span>
  <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span>
  <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span>
  <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span>
  <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span>
  <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span>
  <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span>
  <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span>
  <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span>
  <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span>
  <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>
  <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span>
  <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span>
  <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span>
  <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">16</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>With this knowledge, we can now loop through the keys in the correct order:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> <span class="token number">98</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> keys<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// the rest is the same as above</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>For the rest of the logic, we need to keep track of which keys are currently pressed + when the first switch of a key is pressed:</p>
<pre class="language-c"><code class="language-c"><span class="token comment">/* */</span>
<span class="token keyword">int</span> maxPressTime <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span> <span class="token comment">// if key is pressed slower, nothing happens</span>
<span class="token keyword">int</span> minVelocity <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// velocity of maxPressTime</span>
<span class="token keyword">int</span> maxVelocity <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span> <span class="token comment">// velocity of pressTime 0</span>
<span class="token keyword">int</span> midiChannel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// channel 0 = midi channel #1 (zero index)</span>
bool pressed<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// keys that are currently pressed</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> pressStart<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// remembers keypress starting times</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* */</span>
  bool isConnected <span class="token operator">=</span> <span class="token function">digitalRead</span><span class="token punctuation">(</span>readPin<span class="token punctuation">)</span> <span class="token operator">==</span> LOW<span class="token punctuation">;</span> <span class="token comment">// connection is found for</span>
  bool isDown <span class="token operator">=</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// odd number = switch B =&gt; key is pressed down</span>
  <span class="token keyword">int</span> keyIndex <span class="token operator">=</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 0 - 48 (will round down as it is int)</span>
  <span class="token keyword">int</span> midi <span class="token operator">=</span> keyIndex <span class="token operator">+</span> <span class="token number">36</span><span class="token punctuation">;</span> <span class="token comment">// to start from C2</span>
  bool isPressed <span class="token operator">=</span> pressed<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// is already pressed</span>
  <span class="token comment">/* */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With that info, we can implement everything else:</p>
<pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* */</span>
  <span class="token comment">// keypress starts</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isConnected <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isPressed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDown <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>pressStart<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pressStart<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// key is now fully pressed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isConnected <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isPressed <span class="token operator">&amp;&amp;</span> isDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> pressTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> pressStart<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>pressTime <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>maxPressTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> velocity <span class="token operator">=</span> f <span class="token operator">*</span> <span class="token punctuation">(</span>maxVelocity <span class="token operator">-</span> minVelocity<span class="token punctuation">)</span> <span class="token operator">+</span> minVelocity<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;done pressing &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pressed<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pressTime <span class="token operator">&lt;=</span> maxPressTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// min velocity?</span>
      <span class="token function">noteOn</span><span class="token punctuation">(</span>midiChannel<span class="token punctuation">,</span> midi<span class="token punctuation">,</span> velocity<span class="token punctuation">)</span><span class="token punctuation">;</span>
      MidiUSB<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;on &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>midi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// key is now fully unpressed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isConnected <span class="token operator">&amp;&amp;</span> isPressed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pressed<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">noteOff</span><span class="token punctuation">(</span>midiChannel<span class="token punctuation">,</span> midi<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MidiUSB<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;off &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>midi<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// key is unpressed =&gt; may include keypresses that have started but did not go down</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isConnected <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pressStart<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// reset time when key is released completely</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>That&#x27;s it! You can find the complete code <a target="_blank" href="https://gist.github.com/felixroos/cd7111d1b1a2ba7e381b82faf6abb9e2">here</a>.</p>
<h2 id="4-final-thoughts"><a aria-hidden="true" tabindex="-1" href="/diy-midi-keyboard#4-final-thoughts"><span class="icon icon-link"></span></a>4. Final Thoughts</h2>
<ul>
<li>Now that the keyboard works, I will redo this with the other 39 keys to make 2 keyboards out of one!</li>
<li>In the end, it was not really necessary to reverse engineer the pcb, but it helped for a deeper understanding.</li>
<li>In a future project, I want to use the keyboard to send pitch control voltages to an analog synthesizer instead of midi messages.</li>
<li>I also want to add pitch wheel and mod wheel support + octave change buttons.</li>
</ul></div></article></main></div><div class="py-4 font-serif bg-slate-900 dark:bg-slate-800 text-white flex justify-center items-center"><p class="leading-none"><a class="underline" href="https://github.com/felixroos">Felix Roos</a> <!-- -->2021</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"DIY MIDI Keyboard Scanner","date":"2021-02-11","tags":["diy","electronics"],"description":"How to make two MIDI keyboards out of one..","image":"./img/maudio49/example-connection.png"},"code":"var Component=(()=\u003e{var r=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var i=a=\u003ec(a,\"__esModule\",{value:!0});var m=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),k=(a,n)=\u003e{i(a);for(var s in n)c(a,s,{get:n[s],enumerable:!0})},N=(a,n,s)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let t of d(n))!h.call(a,t)\u0026\u0026t!==\"default\"\u0026\u0026c(a,t,{get:()=\u003en[t],enumerable:!(s=p(n,t))||s.enumerable});return a},b=a=\u003eN(i(c(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var l=m((v,o)=\u003e{o.exports=_jsx_runtime});var f={};k(f,{default:()=\u003ey,frontmatter:()=\u003eg});var e=b(l()),g={title:\"DIY MIDI Keyboard Scanner\",date:\"2021-02-11\",tags:[\"diy\",\"electronics\"],description:\"How to make two MIDI keyboards out of one..\",image:\"./img/maudio49/example-connection.png\"};function w(a){let n=Object.assign({p:\"p\",img:\"img\",a:\"a\",h2:\"h2\",span:\"span\",h3:\"h3\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\"},a.components),{wrapper:s}=n,t=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/arduino-keystation49.png\",alt:\"keystation 49\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"After the \",(0,e.jsx)(n.a,{href:\"../midimoog/\",children:\"Minimoog MIDI Controller\"}),`, here comes another electronics project I did a few days ago.\nAs I had a `,(0,e.jsx)(n.a,{href:\"https://m-audio.de/keystation-88-mkii\",children:\"M Audio Keystation 88 MkII\"}),` laying around that I had replaced with a better master keyboard,\nI decided to tear it open and look inside..`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"1-how-a-midi-keyboard-looks-inside\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#1-how-a-midi-keyboard-looks-inside\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"1. How a MIDI Keyboard looks inside\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The first step was dissassembling all the parts and understanding how they work. I cannot speak for all MIDI Keyboards, but I suppose they all work in a similar way.\"}),`\n`,(0,e.jsx)(n.p,{children:\"After removing the case, this is how the keybed looks like:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/keybed.png\",alt:\"keybed\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The little green pcb holds a microcontroller, which controls the keybed:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/control-pcb.png\",alt:\"control pcb\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Looking from the side, we can see plastic fins that push down buttons when keys are pressed:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/switch.jpeg\",alt:\"switch\"})}),`\n`,(0,e.jsx)(n.p,{children:\"To get a better view, I removed the pcb from the keybed and took a closer look at the buttons:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/switch-inside.jpeg\",alt:\"switch inside\"})}),`\n`,(0,e.jsx)(n.p,{children:`Inside each button, there are two circles with conductive ink above a conductive ink pad that is interrupted by a snake shaped gap.\nIf the buttons are pressed, the circles bridge the gap, connecting the left and right inputs. Long story short, these are switches.`}),`\n`,(0,e.jsxs)(n.h3,{id:\"why-are-there-two-switches-per-key\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#why-are-there-two-switches-per-key\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Why are there two switches per key?\"]}),`\n`,(0,e.jsx)(n.p,{children:`There are two switches per key to be able to measure the velocity of the keystroke.\nAs one circle is slightly more elevated, it will make a connection a little earlier, before the less elevated one.\nThe time between the connections can be used to tell the velocity (smaller time = higher velocity).`}),`\n`,(0,e.jsxs)(n.h2,{id:\"2-analyzing-the-pcb\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#2-analyzing-the-pcb\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"2. Analyzing the PCB\"]}),`\n`,(0,e.jsx)(n.p,{children:`To find out what is going on, I needed to look at the pcb. For all 88 keys, there are 2 pcbs, where one has 49 and the other 39 keys.\nFrom this point, I decided to work with only 49 keys, as it is more handy.`}),`\n`,(0,e.jsx)(n.p,{children:\"Taking a closer look, we can see many diodes on the plastic side:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/diodes.png\",alt:\"diodes\"})}),`\n`,(0,e.jsx)(n.p,{children:\"I took pictures of the other (more interesting) side of the pcb, stitched them together and then redrew the copper lines above the photo:\"}),`\n`,(0,e.jsxs)(\"div\",{style:{display:\"flex\",height:\"500px\",width:\"600px\",overflow:\"auto\"},children:[(0,e.jsx)(\"div\",{style:{width:\"300px\",height:\"1000px\"},children:(0,e.jsx)(\"img\",{alt:\"pcb photo\",src:\"./img/maudio49/pcb_photo.png\"})}),(0,e.jsx)(\"div\",{style:{width:\"300px\",height:\"1000px\"},children:(0,e.jsx)(\"img\",{alt:\"pcb drawn\",src:\"./img/maudio49/pcb_drawing.png\"})})]}),`\n`,(0,e.jsx)(n.p,{children:`From the right image, I then created a more overseeable schematic,\nwhich is not constrained by pcb dimensions:`}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/pcb_schematic_flipped.png\",alt:\"schematic\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"The schematic unveils a logical arrangement of connections that is known as a \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Keyboard_matrix_circuit\",children:\"Keyboard Matrix\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"keyboard-matrix\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#keyboard-matrix\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Keyboard Matrix\"]}),`\n`,(0,e.jsx)(n.p,{children:`The above arrangement of wiring makes it possible to have much less pins than keys.\nHere, we have only 21 pins for 96 switches (2 switches for each of the 49 keys).\nIf we did not use a keyboard matrix, we could just connect each switch directly the microcontroller,\nbut that would cost us 96 pins..`}),`\n`,(0,e.jsx)(n.p,{children:`The 21 pins are connected via 2 plugs with 9 and 12 pins.\nAs we can tell from the direction of the diodes, the current must flow from the 9 pin connector the the 12 pin connector,\nas a diode only allows current flowing in one direction (direction of arrow).`}),`\n`,(0,e.jsx)(n.p,{children:`Now, the idea of the keyboard matrix is this: If we activate only one input pin,\nthe output pins that will be active let us decipher exactly which keys are pressed.\nAs we have 9 input pins and 12 output pins, we have a total of 9*12 = 108 possible combinations,\nwhich is more than enough for our 96 switches.`}),`\n`,(0,e.jsx)(n.p,{children:`Example: If we activate input pin 3, output pin 2 will be active if switch 8A is pressed (A = first, B = second switch).\nWe can verify that by looking at the schematic:`}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/example-connection.png\",alt:\"example connection\"})}),`\n`,(0,e.jsx)(n.p,{children:\"To get a better overview, we can create a table to show which combination of pins corresponds to which key switch:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/matrix-table.png\",alt:\"matrix table\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Of course, the values of this table will depend on the keyboard model, but the structure should be the same.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"verifying-the-matrix-table\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#verifying-the-matrix-table\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Verifying the Matrix Table\"]}),`\n`,(0,e.jsx)(n.p,{children:`To verify that I am on the track, I used a multimeter in diode testing mode and connected the plus side to an input pin and the minus side to an output pin.\nPressing the key that corresponds to the pin combination should then make a connection, while others do nothing.\nI was quite happy to find out everything behaved as expected.`}),`\n`,(0,e.jsxs)(n.h3,{id:\"what-a-keyboard-scanner-does\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-a-keyboard-scanner-does\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What a Keyboard Scanner does\"]}),`\n`,(0,e.jsx)(n.p,{children:`Now that we know how the keyboard matrix works, we can start to think of how to handle it.\nIn the end, we want a midi signal each time a key is pressed (note on) and depressed (note off).\nThis task is handled by the keyboard scanner, which is a microcontroller that repeatedly tests all pin combinations very quickly.\nIf a test for a particular combination is positive, a midi signal is sent for the key corresponding to that combination.`}),`\n`,(0,e.jsxs)(n.h2,{id:\"3-arduino-keyboard-scanner\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#3-arduino-keyboard-scanner\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"3. Arduino Keyboard Scanner\"]}),`\n`,(0,e.jsx)(n.p,{children:`As the already existing microcontroller is a black box, let's wire up our own keyboard scanner with an Arduino Micro.\nThe Arduino Micro is perfect for that task, as it acts as a class compliant USB device.`}),`\n`,(0,e.jsxs)(n.p,{children:[`The only problem: The Arduino Micro only has 20 input pins, but we need 21 for our 49 keys.\nTo fix that, we can use multiplexers, like already used `,(0,e.jsx)(n.a,{href:\"../midimoog/#analog-input-multiplexing\",children:\"for the midimoog\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"schematic\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#schematic\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Schematic\"]}),`\n`,(0,e.jsx)(n.p,{children:'This time, I started soldering without a plan (not recommended), but drew the \"schematic\" afterwards:'}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/scanner-schematic.png\",alt:\"scanner schematic\"})}),`\n`,(0,e.jsx)(n.p,{children:\"I did not explicitly draw all connections, this is the meaning of the colors:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"red is 5V\"}),`\n`,(0,e.jsx)(n.li,{children:\"black is ground\"}),`\n`,(0,e.jsx)(n.li,{children:\"gray numbers are keybed pins (top ic goes to input pins, bottom ics go to output pins)\"}),`\n`,(0,e.jsx)(n.li,{children:\"blue are the select pins / cables\"}),`\n`,(0,e.jsx)(n.li,{children:\"yellow is the input\"}),`\n`,(0,e.jsx)(n.li,{children:\"green are the outputs\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"soldering\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#soldering\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Soldering\"]}),`\n`,(0,e.jsx)(n.p,{children:\"After soldering it all together, the connected board board looked like this:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"./img/maudio49/arduino-scanner-pcb.png\",alt:\"scanner pcb\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"code\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#code\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Code\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The basic idea of how to check if a key is pressed goes like this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// send voltage to input pin\"}),`\n`,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"inputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"outputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// key is pressed =\u003e send midi or whatever\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`The Problem: If a key is NOT pressed, the output pin might still be HIGH if it is not connected to ground with a pulldown resistor,\nas it is \"hanging in mid air\". When I realized that, I already soldered everything together..`}),`\n`,(0,e.jsxs)(n.p,{children:[\"Luckily, Arduino comes with \",(0,e.jsx)(n.a,{href:\"https://www.arduino.cc/en/Tutorial/DigitalInputPullup\",children:\"internal pullup resistors\"}),`.\nThis makes soldering resistors to each input obsolete. But, unluckily, there are no internal pulldown resistors, which means we have to flip the logic:`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"outputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"inputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" INPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"inputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// pullup\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// send output pin LOW\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"outputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"inputPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// key is pressed =\u003e send midi or whatever\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`It took me a while to find this trick, but it makes sense:\nInstead of setting an output HIGH, we set the input LOW, which results in the current keep flowing through the diodes in the right direction.`}),`\n`,(0,e.jsx)(n.p,{children:\"Now, here is the code with all the correct ins and outs, according to the schematic:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setup\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"begin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9600\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"//select pins\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ABC of INPUT\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ABC of OUTPUTs\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" INPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// gray\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// pullup\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" INPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// yellow\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" HIGH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// pullup\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// green\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"pinMode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" OUTPUT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// green\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"set4051\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" pinA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" pinB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" pinC\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// A = least significant bit\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// bitRead also starts from least significant bit\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pinA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pinB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pinC\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"channel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// loop through all switches (98 = 49 * 2)\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"98\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" k\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// values between 0 to 8 (input pins)\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" o \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// values between 0 and 11 (output pins)\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// use input pin 5 for i == 8\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" readPin \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"set4051\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// select input channel\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"set4051\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// select output channel\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// use output 7 for o \u003c 8 and output 8 for o \u003e= 8\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalWrite\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"bitRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"readPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// connected\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:`With this code, the serial monitor will print number k everytime a key is pressed.\nThis prevents us from the total brainfuck of thinking through which combination of inputs and outputs lead to which key.`}),`\n`,(0,e.jsx)(n.p,{children:`All we have to do is press each key lightly first (switch A), then to the bottom (switch B) and write the logged numbers to a list.\nFor my wiring, the list looks like this:`}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" keys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"98\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"31\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"29\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"59\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"83\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"104\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"107\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"92\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"95\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"68\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"71\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"20\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"23\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"82\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"81\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"106\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"105\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"94\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"93\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"70\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"69\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"45\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"21\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"48\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"51\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"72\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"75\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"96\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"99\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"84\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"87\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"63\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"36\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"15\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"49\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"74\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"73\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"98\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"97\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"86\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"85\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"62\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"61\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"38\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"37\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"13\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"55\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"53\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"79\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"77\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"103\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"101\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"91\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"89\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"67\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"41\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"19\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"54\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"52\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"78\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"76\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"102\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"90\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"88\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"66\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"64\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"42\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"40\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"With this knowledge, we can now loop through the keys in the correct order:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"98\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" n\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" keys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"n\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// the rest is the same as above\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"For the rest of the logic, we need to keep track of which keys are currently pressed + when the first switch of a key is pressed:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* */\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" maxPressTime \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"250\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// if key is pressed slower, nothing happens\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" minVelocity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// velocity of maxPressTime\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" maxVelocity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"90\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// velocity of pressTime 0\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" midiChannel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// channel 0 = midi channel #1 (zero index)\"}),`\nbool pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"49\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// keys that are currently pressed\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"long\"}),\" pressStart\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"49\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// remembers keypress starting times\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* */\"}),`\n  bool isConnected `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"digitalRead\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"readPin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" LOW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// connection is found for\"}),`\n  bool isDown `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// odd number = switch B =\u003e key is pressed down\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" keyIndex \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// 0 - 48 (will round down as it is int)\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" midi \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" keyIndex \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"36\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// to start from C2\"}),`\n  bool isPressed `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" pressed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// is already pressed\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* */\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:\"With that info, we can implement everything else:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* */\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// keypress starts\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"isConnected \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isPressed \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isDown \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"pressStart\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      pressStart`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"millis\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// key is now fully pressed\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"isConnected \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isPressed \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" isDown\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"long\"}),\" pressTime \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"millis\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" pressStart\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),\" f \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"pressTime \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"maxPressTime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" velocity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" f \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"maxVelocity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" minVelocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" minVelocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"done pressing \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n    pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pressTime \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c=\"}),\" maxPressTime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// min velocity?\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" midi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" velocity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      MidiUSB`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"flush\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n        Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"on \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n        Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"midi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n        Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\" \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// key is now fully unpressed\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isConnected \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" isPressed \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isDown\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    pressed`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"noteOff\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"midiChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" midi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    MidiUSB`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"flush\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"off \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"midi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\" \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n      Serial`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\" \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// key is unpressed =\u003e may include keypresses that have started but did not go down\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isConnected \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"isDown\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    pressStart`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"keyIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// reset time when key is released completely\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"That's it! You can find the complete code \",(0,e.jsx)(n.a,{href:\"https://gist.github.com/felixroos/cd7111d1b1a2ba7e381b82faf6abb9e2\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"4-final-thoughts\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#4-final-thoughts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"4. Final Thoughts\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Now that the keyboard works, I will redo this with the other 39 keys to make 2 keyboards out of one!\"}),`\n`,(0,e.jsx)(n.li,{children:\"In the end, it was not really necessary to reverse engineer the pcb, but it helped for a deeper understanding.\"}),`\n`,(0,e.jsx)(n.li,{children:\"In a future project, I want to use the keyboard to send pitch control voltages to an analog synthesizer instead of midi messages.\"}),`\n`,(0,e.jsx)(n.li,{children:\"I also want to add pitch wheel and mod wheel support + octave change buttons.\"}),`\n`]})]});return s?(0,e.jsx)(s,Object.assign({},a,{children:t})):t}var y=w;return f;})();\n;return Component.default;"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"diy-midi-keyboard"},"buildId":"iXthh_4XGgKtotftD4wfY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>