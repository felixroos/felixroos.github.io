<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem("theme");if(e){d.add(e)}else{d.add('light');}}catch(t){}}();</script><title>Loophole Letters</title><meta content="This is where felixroos writes about music and coding and stuff that he finds interesting." name="description"/><meta property="og:url" content="https://felixroos.github.io/rhythmical-ast"/><link rel="canonical" href="https://felixroos.github.io/rhythmical-ast"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta property="og:type" content="website"/><meta property="og:site_name" content="Loophole Letters"/><meta property="og:description" content="This is where felixroos writes about music and coding and stuff that he finds interesting."/><meta property="og:title" content="Loophole Letters"/><meta property="og:image" content="https://felixroos.github.io/images/site-preview.png"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/6e75c733fbeaed830339.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e75c733fbeaed830339.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-ddd010a953737b6e3536.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-0a4e994bdc39ff189532.js" defer=""></script><script src="/_next/static/chunks/pages/_app-90a80ff1cc8d4db09709.js" defer=""></script><script src="/_next/static/chunks/763-f6d617bee32818d913b2.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-f23579629df7f22d89c7.js" defer=""></script><script src="/_next/static/wuEW8MNgv72SY3fwYy_Nv/_buildManifest.js" defer=""></script><script src="/_next/static/wuEW8MNgv72SY3fwYy_Nv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="z-[1999] sticky top-0 bg-slate-900 dark:bg-slate-800 font-semibold p-2 text-white flex justify-center shadow-xl border-b border-gray-500 dark:border-gray-800"><div class="max-w-3xl w-full p-2 flex justify-between items-center"><h1 class="text-3xl"><a href="/">âˆž loophole letters</a> </h1></div></header><div class="flex justify-center min-h-full dark:bg-slate-900 py-4"> <main class="max-w-3xl p-2"><article class="prose font-serif max-w-none  prose-headings:font-sans prose-headings:font-black prose-headings:text-slate-900  dark:prose-headings:text-gray-200  dark:text-gray-400 dark:prose-strong:text-gray-400 dark:prose-code:text-slate-400 dark:prose-a:text-gray-300 prose-a:text-slate-900 prose-blockquote:text-slate-800 dark:prose-blockquote:text-slate-400"><div class="border-b-4 border-dotted pb-2 border-slate-900 mb-4"><div class="md:flex justify-between"><h1 class="mb-4 ">Rhythmical AST</h1><div class="flex space-x-2 items-start pb-4 md:pb-0"><div class="text-sm  bg-slate-200 dark:bg-slate-700 rounded-md p-2 font-serif text-slate-900 dark:text-white">code</div><div class="text-sm  bg-slate-200 dark:bg-slate-700 rounded-md p-2 font-serif text-slate-900 dark:text-white">rhythmical</div></div></div><p class="italic p-0 m-0">December 29, 2021</p></div><div><p>AST</p>
<h2 id="features"><a aria-hidden="true" tabindex="-1" href="/rhythmical-ast#features"><span class="icon icon-link"></span></a>Features</h2>
<ul>
<li>traverse items aka Tree.forEach</li>
<li>modify items aka Tree.map</li>
<li>remove items aka Tree.filter</li>
<li>reduce items aka Tree.reduce</li>
<li>keep pure state while reducing??</li>
<li>skip?</li>
</ul>
<h3 id="example-features"><a aria-hidden="true" tabindex="-1" href="/rhythmical-ast#example-features"><span class="icon icon-link"></span></a>Example Features</h3>
<ul>
<li><code>[&#x27;x*3&#x27;,&#x27;y&#x27;]</code> =&gt; <code>[&#x27;x&#x27;,&#x27;x&#x27;,&#x27;x&#x27;,&#x27;y&#x27;]</code> (reduce)</li>
<li><code>[&#x27;a&#x27;,[&#x27;b&#x27;,&#x27;c&#x27;]]</code> =&gt; <code>[&#x27;a:0,1&#x27;,&#x27;b:1,0.5&#x27;,&#x27;c:1.5,0.5&#x27;]</code> (flatten / reduce)</li>
<li><code>[&#x27;C&#x27;,&#x27;F&#x27;]</code> =&gt; <code>[p([&#x27;C3&#x27;,&#x27;E3&#x27;,&#x27;G3&#x27;]), p([&#x27;F3&#x27;,&#x27;A3&#x27;,&#x27;C4&#x27;])]</code> (map &amp; skip?)</li>
</ul>
<h2 id="ideas"><a aria-hidden="true" tabindex="-1" href="/rhythmical-ast#ideas"><span class="icon icon-link"></span></a>Ideas</h2>
<ul>
<li>transform rhythmical object to unified AST for easier traversal</li>
<li>try to wrap traveral + mutation inside immer for immutable tree transforms</li>
<li>write better rhythmical typings</li>
<li>think about NLR / LRN</li>
<li>try if unist has the required tools to implement rhythmical</li>
<li>try to write regular Array.map that does tree mutation</li>
</ul>
<h2 id="treemap"><a aria-hidden="true" tabindex="-1" href="/rhythmical-ast#treemap"><span class="icon icon-link"></span></a>Tree.map</h2>
<pre class="language-js"><code class="language-js"><span class="token punctuation">[</span><span class="token string">&#x27;a&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#x27;b&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;c&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token function">nested</span><span class="token punctuation">(</span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>
<span class="token comment">// c</span>

<span class="token keyword">function</span> <span class="token function">nested</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> getChildren</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    node <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mutate before</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token function">getChildren</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>children<span class="token operator">?.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> children<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token function">nested</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> getChildren<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mutate after</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></article></main></div><div class="py-4 font-serif bg-slate-900 dark:bg-slate-800 text-white flex justify-center items-center"><p class="leading-none"><a class="underline" href="https://github.com/felixroos">Felix Roos</a> <!-- -->2021</p></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Rhythmical AST","date":"2021-12-29","tags":["code","rhythmical"],"description":"blabla","draft":true},"code":"var Component=(()=\u003e{var o=Object.create;var t=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var l=a=\u003et(a,\"__esModule\",{value:!0});var m=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),k=(a,n)=\u003e{l(a);for(var s in n)t(a,s,{get:n[s],enumerable:!0})},N=(a,n,s)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let c of p(n))!u.call(a,c)\u0026\u0026c!==\"default\"\u0026\u0026t(a,c,{get:()=\u003en[c],enumerable:!(s=d(n,c))||s.enumerable});return a},f=a=\u003eN(l(t(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=m((j,i)=\u003e{i.exports=_jsx_runtime});var b={};k(b,{default:()=\u003ex,frontmatter:()=\u003ey});var e=f(r()),y={title:\"Rhythmical AST\",date:\"2021-12-29\",tags:[\"code\",\"rhythmical\"],description:\"blabla\",draft:!0};function g(a){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",h3:\"h3\",code:\"code\",pre:\"pre\"},a.components),{wrapper:s}=n,c=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"AST\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"features\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#features\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Features\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"traverse items aka Tree.forEach\"}),`\n`,(0,e.jsx)(n.li,{children:\"modify items aka Tree.map\"}),`\n`,(0,e.jsx)(n.li,{children:\"remove items aka Tree.filter\"}),`\n`,(0,e.jsx)(n.li,{children:\"reduce items aka Tree.reduce\"}),`\n`,(0,e.jsx)(n.li,{children:\"keep pure state while reducing??\"}),`\n`,(0,e.jsx)(n.li,{children:\"skip?\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"example-features\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#example-features\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Example Features\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"['x*3','y']\"}),\" =\u003e \",(0,e.jsx)(n.code,{children:\"['x','x','x','y']\"}),\" (reduce)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"['a',['b','c']]\"}),\" =\u003e \",(0,e.jsx)(n.code,{children:\"['a:0,1','b:1,0.5','c:1.5,0.5']\"}),\" (flatten / reduce)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"['C','F']\"}),\" =\u003e \",(0,e.jsx)(n.code,{children:\"[p(['C3','E3','G3']), p(['F3','A3','C4'])]\"}),\" (map \u0026 skip?)\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"ideas\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#ideas\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Ideas\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"transform rhythmical object to unified AST for easier traversal\"}),`\n`,(0,e.jsx)(n.li,{children:\"try to wrap traveral + mutation inside immer for immutable tree transforms\"}),`\n`,(0,e.jsx)(n.li,{children:\"write better rhythmical typings\"}),`\n`,(0,e.jsx)(n.li,{children:\"think about NLR / LRN\"}),`\n`,(0,e.jsx)(n.li,{children:\"try if unist has the required tools to implement rhythmical\"}),`\n`,(0,e.jsx)(n.li,{children:\"try to write regular Array.map that does tree mutation\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"treemap\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#treemap\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Tree.map\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'a'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'b'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'c'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"nested\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token console class-name\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// a\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// b\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"// c\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nested\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[\"fn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" getChildren\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"node\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n    node `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"fn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// mutate before\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" children \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getChildren\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"children\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),\"length\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n      `,(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" children\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"nested\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"fn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" getChildren\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"fn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"node\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// mutate after\"}),`\n  `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})]});return s?(0,e.jsx)(s,Object.assign({},a,{children:c})):c}var x=g;return b;})();\n;return Component.default;"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"rhythmical-ast"},"buildId":"wuEW8MNgv72SY3fwYy_Nv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>